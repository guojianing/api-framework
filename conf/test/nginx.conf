user  www;
worker_processes  auto;

pid        logs/nginx.pid;

events {
    worker_connections  1024;
    multi_accept        on;
    use                 epoll;
}


http {
    fastcgi_hide_header X-Powered-By;
    server_tokens off; 
    include       mime.types;
    default_type  application/octet-stream;

    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for" ($request_time $upstream_response_time)';

    

    sendfile        on;
    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout  65;

    #gzip  on;
	
	server {
	    listen 80;
	    server_name assets.biaobaiapp.com;

	    root /mnt/htdocs/assets;
	    index index.html index.htm index.php;

	    location = /favicon.ico {
		    log_not_found off;
	    }
	    
    }

    server {
        listen 80;
        server_name  test.xiuxiaobai.com;

        root /mnt/web;
        index index.php;

        location / {
            try_files $uri $uri/ /index.php$is_args$args;
        }

        #下载地址
        location = /d {
            try_files $uri $uri/ /d.php$is_args$args;
        }

        location ~ \.php$ {
            try_files $uri =404;

            include fastcgi.conf;
            fastcgi_pass 127.0.0.1:9000;
            fastcgi_param env test;
        }

        location = /favicon.ico {
            log_not_found off;
            access_log off;
        }

        location /biaobai-nginx-status {
            #stub_status on;
            access_log off;
        }
    }
	
    server {
	    listen 80 backlog=8192;
	    server_name test.biaobaiapp.com;

	    root /mnt/htdocs;
	    index index.html index.htm index.php;

	    location / {
		    try_files $uri $uri/ /index.php$is_args$args;
	    }

	    location ~ \.php$ {
		    try_files $uri =404;

		    include fastcgi.conf;
		    fastcgi_pass 127.0.0.1:9000;
		    fastcgi_param env test;

            #fastcgi_param PHP_VALUE "auto_prepend_file=/mnt/xhprof/external/header.php \n auto_append_file=/mnt/xhprof/external/footer.php";
	    }

	    location = /favicon.ico {
		    log_not_found off;
		    access_log off;
	    }

        location ~* \.(txt|ini)$ {
            deny all;
        }

        location /biaobaiapp-nginx-status {
            #stub_status on;
            access_log off;
        }

        location  /php-fpm-status {
            access_log off;
            include fastcgi.conf;
            fastcgi_pass 127.0.0.1:9000;
        }
    }

    server {
        listen 8888;
        server_name test.biaobaiapp.com;

        root /mnt/xhprof;
        index index.html index.htm index.php;

        location / {
            try_files $uri $uri/ /index.php$is_args$args;
        }

        location ~ \.php$ {
            try_files $uri =404;

            include fastcgi.conf;
            fastcgi_pass 127.0.0.1:9000;
            fastcgi_param env test;
        }

        location = /favicon.ico {
            log_not_found off;
            access_log off;
        }
    }

    server {
        listen 80;
        server_name test.biaobai.im;

        root /mnt/server_size;
        index index.html index.htm index.php;

        error_log   /mnt/data/log/biaobai-nginx-error.log;
        access_log  /mnt/data/log/biaobai-nginx-access.log  main;

        location ~* ^/(ios|andriod)/([-_a-zA-Z0-9/]+)/([-_a-zA-Z0-9/]+) {
           default_type application/json;
           content_by_lua_file /mnt/server_size/openresty/api/$2/$3.lua;
        }

        location / {
            try_files $uri $uri/ /index.php$is_args$args;
        }

        location ~ \.php$ {
            try_files $uri =404;

            include fastcgi.conf;
            fastcgi_pass 127.0.0.1:9000;
            fastcgi_param env test;
        }

        location ~* ^/api/([-_a-zA-Z0-9/]+) {
            default_type application/json;
            content_by_lua_file /mnt/server_size/openresty/api/$1.lua;
        }

        location = /favicon.ico {
            log_not_found off;
            access_log off;
        }
    }
}
